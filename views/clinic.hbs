<div class="row my-3 p-10 bg-white border rounded">
    <div class="col-12 mb-4 d-flex justify-content-between align-items-center my-5">
        <div>
            <h3>Clinics</h3>
        </div>
        <div style="padding:10px 20px 10px 20px;" class="clinic_add_btn btn btn-light-primary btn-icon"><i
                class='fa fa-plus'></i></div>
    </div>
    <div class="col-12">
        <div class="table-responsive">
            <table class="table" id="clinic_tb">
                <thead>
                    <th>Clinic ID</th>
                    <th>Name</th>
                    <th>Address</th>
                    <th>Email</th>
                    <th>Phone</th>
                    <th>Web</th>
                    <th>Action</th>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>
    </div>
</div>
<div class="modal fade" id="clinic_modal">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <input type="hidden" id="modal_type" />
            <!-- Modal Header -->
            <div class="modal-header">
                <h4 class="modal-title ">Clinic</h4>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <!-- Modal body -->
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-2">
                        <div class="form-group">
                            <h6>Clinic ID</h6>
                            <input id="clinic_id" class="form-control" type="text" />
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <h6>Name</h6>
                            <input id="clinic_name" class="form-control" type="text" />
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <h6>Acronym</h6>
                            <input id="clinic_acronym" class="form-control" type="text" />
                        </div>
                    </div>
                    <div class="col-md-12">
                        <div class="form-group">
                            <h6>Address1</h6>
                            <input id="clinic_address1" class="form-control" type="text" />
                        </div>
                    </div>
                    <div class="col-md-12">
                        <div class="form-group">
                            <h6>Address2</h6>
                            <input id="clinic_address2" class="form-control" type="text" />
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <h6>City</h6>
                            <input id="clinic_city" class="form-control" type="text" />
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <h6>State</h6>
                            <select id="clinic_state" class="form-control custom-select">
                                <optgroup label="Alaskan/Hawaiian Time Zone">
                                    <option value="AK">Alaska</option>
                                    <option value="HI">Hawaii</option>
                                </optgroup>
                                <optgroup label="Pacific Time Zone">
                                    <option value="CA">California</option>
                                    <option value="NV">Nevada</option>
                                    <option value="OR">Oregon</option>
                                    <option value="WA">Washington</option>
                                </optgroup>
                                <optgroup label="Mountain Time Zone">
                                    <option value="AZ">Arizona</option>
                                    <option value="CO">Colorado</option>
                                    <option value="ID">Idaho</option>
                                    <option value="MT">Montana</option>
                                    <option value="NE">Nebraska</option>
                                    <option value="NM">New Mexico</option>
                                    <option value="ND">North Dakota</option>
                                    <option value="UT">Utah</option>
                                    <option value="WY">Wyoming</option>
                                </optgroup>
                                <optgroup label="Central Time Zone">
                                    <option value="AL">Alabama</option>
                                    <option value="AR">Arkansas</option>
                                    <option value="IL">Illinois</option>
                                    <option value="IA">Iowa</option>
                                    <option value="KS">Kansas</option>
                                    <option value="KY">Kentucky</option>
                                    <option value="LA">Louisiana</option>
                                    <option value="MN">Minnesota</option>
                                    <option value="MS">Mississippi</option>
                                    <option value="MO">Missouri</option>
                                    <option value="OK">Oklahoma</option>
                                    <option value="SD">South Dakota</option>
                                    <option value="TX">Texas</option>
                                    <option value="TN">Tennessee</option>
                                    <option value="WI">Wisconsin</option>
                                </optgroup>
                                <optgroup label="Eastern Time Zone">
                                    <option value="CT">Connecticut</option>
                                    <option value="DE">Delaware</option>
                                    <option value="FL">Florida</option>
                                    <option value="GA">Georgia</option>
                                    <option value="IN">Indiana</option>
                                    <option value="ME">Maine</option>
                                    <option value="MD">Maryland</option>
                                    <option value="MA">Massachusetts</option>
                                    <option value="MI">Michigan</option>
                                    <option value="NH">New Hampshire</option>
                                    <option value="NJ">New Jersey</option>
                                    <option value="NY" selected>New York</option>
                                    <option value="NC">North Carolina</option>
                                    <option value="OH">Ohio</option>
                                    <option value="PA">Pennsylvania</option>
                                    <option value="RI">Rhode Island</option>
                                    <option value="SC">South Carolina</option>
                                    <option value="VT">Vermont</option>
                                    <option value="VA">Virginia</option>
                                    <option value="WV">West Virginia</option>
                                </optgroup>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <h6>Zip</h6>
                            <input id="clinic_zip" class="form-control" type="text" />
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <h6>Phone</h6>
                            <input id="clinic_phone" class="form-control" type="text" />
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <h6>Email</h6>
                            <input id="clinic_email" class="form-control" type="text" />
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <h6>Web</h6>
                            <input id="clinic_web" class="form-control" type="text" />
                        </div>
                    </div>
                    <div class="col-md-8">
                        <div class="form-group">
                            <h6>Portal</h6>
                            <input id="clinic_portal" class="form-control" type="text" />
                        </div>
                    </div>
                </div>
            </div>
            <!-- Modal footer -->
            <div class="modal-footer">
                <button type="button" class="btn btn-light-primary clinic_modal_confirm"
                    data-dismiss="modal">Done</button>
                <button type="button" class="btn btn-light-danger" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="clinic_insurance_modal">
    <div class="modal-dialog modal-md modal-dialog-scrollable">
        <input type="hidden" id="modal_clinic_id" />
        <div class="modal-content">
            <!-- Modal Header -->
            <div class="modal-header">
                <h4 class="modal-title ">Clinic Insurances</h4>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <!-- Modal body -->
            <div class="modal-body">
                <div class="d-flex justify-content-start align-items-center px-5 mb-5 mx-1">
                    <input type="checkbox" style="width: 24px; height: 24px;" id="clinic_insurance_all" class="mx-1"
                        value="0" />
                    <label for="clinic_insurance_all" class="align-items-center m-0">
                        <h6 class="m-0">&nbsp;ALL</h6>
                    </label>
                </div>
                <div class="separator separator-solid mb-5"></div>
                <div class="row mx-1" id="clinic_insurance_list"></div>
            </div>
            <!-- Modal footer -->
            <div class="modal-footer">
                <button type="button" class="btn btn-light-primary clinic_insurance_modal_confirm"
                    data-dismiss="modal">Done</button>
                <button type="button" class="btn btn-light-danger" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
<script>
    var __item_count = 0
    var __selected_item_count = 0
    $(document).ready(() => {
        $.ajax({
            url: "{{env.HOST_URL}}{{env.PREFIX_URL}}/insurance/readOnlyNames",
            method: "POST",
            data: {},
            dataType: 'json',
            success: function (res) {
                let html = ""
                __item_count = 0
                res.data.forEach(item => {
                    __item_count++;
                    html += `<div class="col-md-12 d-flex justify-content-start align-items-center mx-5 mb-5">
                            <input class="clinic_insurance_items" type="checkbox" style="width: 24px; height: 24px;" id="clinic_insurance_item_${item.id}" class="mx-1"
                                value="${item.id}" />
                            <label for="clinic_insurance_${item.id}" class="align-items-center m-0">
                                <h6 class="m-0">&nbsp;${item.name}</h6>
                            </label>
                        </div>`
                })
                $("#clinic_insurance_list").html(html)
            }
        })

        let clinic_tb = $('#clinic_tb').DataTable({
            "pagingType": "full_numbers",
            "lengthMenu": [
                [10, 25, 50, -1],
                [10, 25, 50, "All"]
            ],
            language: {
                search: "_INPUT_",
                searchPlaceholder: "Search records",
            },
            "ajax": {
                "url": "{{env.HOST_URL}}{{env.PREFIX_URL}}/clinic/read",
                "type": "POST"
            },
            "columns": [
                { data: 'clinic_id' },
                { data: 'name' },
                { data: 'address1' },
                { data: 'email' },
                { data: 'phone' },
                { data: 'web' },
                {
                    data: 'id',
                    render: function (data, type, row) {
                        return `
                        <div idkey="`+ row.id + `">
                            <span class="btn btn-icon btn-sm btn-light-success clinic_insurance_btn"><i class="fa flaticon2-delivery-package"></i></span>
                            <span class="btn btn-icon btn-sm btn-light-warning clinic_edit_btn"><i class="fas fa-edit"></i></span>
                            <span class="btn btn-icon btn-sm btn-light-danger  clinic_delete_btn"><i class="fas fa-trash"></i></span>
                        </div>
                        `
                    }
                }
            ]
        });

        $(".clinic_add_btn").click(function () {
            $("#modal_type").val("0")

            $("#clinic_id").val("");
            $("#clinic_name").val("");
            $("#clinic_acronym").val("");
            $("#clinic_address1").val("");
            $("#clinic_address2").val("");
            $("#clinic_city").val("");
            $("#clinic_state").val("NY");
            $("#clinic_zip").val("");
            $("#clinic_phone").val("");
            $("#clinic_email").val("");
            $("#clinic_web").val("");
            $("#clinic_portal").val("");

            $("#clinic_modal").modal('show');
        });

        $(".clinic_modal_confirm").click(function () {
            $.ajax({
                url: `{{env.HOST_URL}}{{env.PREFIX_URL}}/clinic/${$("#modal_type").val() == "0" ? 'createClinic' : 'updateClinic'}`,
                method: "POST",
                data: {
                    id: window.id,
                    clinic_id: $("#clinic_id").val(),
                    name: $("#clinic_name").val(),
                    acronym: $("#clinic_acronym").val(),
                    address1: $("#clinic_address1").val(),
                    address2: $("#clinic_address2").val(),
                    city: $("#clinic_city").val(),
                    zip: $("#clinic_zip").val(),
                    state: $("#clinic_state").val(),
                    email: $("#clinic_email").val(),
                    phone: $("#clinic_phone").val(),
                    web: $("#clinic_web").val(),
                    portal: $("#clinic_portal").val(),
                },
                dataType: "text",
                success: function (data) {
                    handleTableResponse(data, '#clinic_tb', $("#modal_type").val() == "0" ? 'Add' : 'Update');
                }
            });
        });

        $(document).on("click", ".clinic_insurance_btn", function () {
            $("#modal_clinic_id").val($(this).parent().attr("idkey"))
            $.ajax({
                url: "{{env.HOST_URL}}{{env.PREFIX_URL}}/clinic_insurance/readInsuranceOfClinic",
                method: "POST",
                data: { clinic_id: $(this).parent().attr("idkey") },
                dataType: 'json',
                success: function (res) {
                    $("#clinic_insurance_all").prop("checked", false)
                    $(".clinic_insurance_items").prop("checked", false)
                    __selected_item_count = res.length
                    res.forEach(item => {
                        $(`#clinic_insurance_item_${item.insurance_id}`).prop('checked', true)
                    })

                    if (__selected_item_count == __item_count) {
                        $("#clinic_insurance_all").prop("checked", true)
                    } else {
                        $("#clinic_insurance_all").prop("checked", false)
                    }

                    $("#clinic_insurance_modal").modal("show")

                    $("#clinic_insurance_modal").modal("show")
                }
            })
        })

        $(document).on("click", ".clinic_edit_btn", function () {
            $("#modal_type").val("1")
            window.id = $(this).parent().attr("idkey");
            $.ajax({
                url: '{{env.HOST_URL}}{{env.PREFIX_URL}}/clinic/readOneClinic',
                method: "POST",
                data: { id: window.id },
                dataType: "json",
                success: function (data) {
                    $("#clinic_id").val(data['clinic_id']);
                    $("#clinic_name").val(data['name']);
                    $("#clinic_acronym").val(data['acronym']);
                    $("#clinic_address1").val(data['address1']);
                    $("#clinic_address2").val(data['address2']);
                    $("#clinic_city").val(data['city']);
                    $("#clinic_state").val(data['state']);
                    $("#clinic_zip").val(data['zip']);
                    $("#clinic_phone").val(data['phone']);
                    $("#clinic_email").val(data['email']);
                    $("#clinic_web").val(data['web']);
                    $("#clinic_portal").val(data['portal']);

                    $("#clinic_modal").modal('show');
                }
            });
        });

        $(document).on("click", ".clinic_delete_btn", function () {
            window.id = $(this).parent().attr("idkey");
            var tmp = $(this).parent().parent().parent();
            Swal.fire({
                title: 'Are you sure?',
                text: "You won't be able to revert this!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: 'Yes, delete it!'
            }).then((result) => {
                if (result.value) {
                    $.ajax({
                        url: '{{env.HOST_URL}}{{env.PREFIX_URL}}/clinic/deleteClinic',
                        method: "POST",
                        data: { id: window.id },
                        dataType: "text",
                        success: function (data) {
                            if (data = "ok")
                                tmp.remove();
                        }
                    });
                }
            });
        });

        $("#clinic_insurance_all").click(function () {
            if ($(this).prop('checked') == true) {
                $(".clinic_insurance_items").prop('checked', true)
            } else {
                $(".clinic_insurance_items").prop('checked', false)
            }
            $.ajax({
                url: `{{env.HOST_URL}}{{env.PREFIX_URL}}/clinic_insurance/${$(this).prop("checked") == true ? "createByClinic" : "deleteByClinic"}`,
                method: "POST",
                data: { clinic_id: $("#modal_clinic_id").val() },
                dataType: 'text',
                success: function (res) {
                    if (res == "ok") {
                        toastr.success("Success!")
                    } else {
                        toastr.error("Failed!")
                    }
                },
                error: function (error) {
                    toastr.error("Error!")
                }
            })
        })

        $(document).on("click", ".clinic_insurance_items", function () {
            $.ajax({
                url: `{{env.HOST_URL}}{{env.PREFIX_URL}}/clinic_insurance/${$(this).prop("checked") == true ? "createClinicInsurance" : "deleteByInsuranceAndClinic"}`,
                method: "POST",
                data: { clinic_id: $("#modal_clinic_id").val(), insurance_id: $(this).val() },
                dataType: 'text',
                success: function (res) {
                    if (res == "ok") {
                        toastr.success("Success!")
                    } else {
                        toastr.error("Failed!")
                    }
                },
                error: function (error) {
                    toastr.error("Error!")
                }
            })

            $(this).prop("checked") == true ? __selected_item_count++ : __selected_item_count--;

            if (__selected_item_count == __item_count) {
                $("#clinic_insurance_all").prop("checked", true)
            } else {
                $("#clinic_insurance_all").prop("checked", false)
            }
        })
    });
</script>